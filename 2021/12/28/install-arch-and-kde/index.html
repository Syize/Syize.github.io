<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="utf-8">

    

    <!-- 渲染优化 -->
    <meta name="renderer" content="webkit">
    <meta name="force-rendering" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="HandheldFriendly" content="True" >
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <!--icon-->

    
        <link rel="shortcut icon" href="/images/favicon.ico">
    
    
    
    
    


    <!-- meta -->


<title>Arch Linux, KDE 桌面及各种服务安装过程 | Syize の blog</title>


    <meta name="keywords" content="Arch, KDE">




    <!-- OpenGraph -->
 
    <meta name="description" content="写在前面 更新完毕 2023-01-10：根据台式机的安装过程修改和更新更多细节以符合 2023-01-01 镜像安装的过程，增添更多配置过程。本篇博客介绍的安装过程没有使用 arch-install-scripts。  在考研的时候我就在思考，我到底为什么写博客。如果仅仅是展示自己的知识的话，那么我想懂得人并不会有多细看我的博客，而不懂的人也很有可能看不懂。 在又一次折腾完我的 Arch 之后，">
<meta property="og:type" content="article">
<meta property="og:title" content="Arch Linux, KDE 桌面及各种服务安装过程">
<meta property="og:url" content="https://blog.syize.cn/2021/12/28/install-arch-and-kde/index.html">
<meta property="og:site_name" content="Syize の blog">
<meta property="og:description" content="写在前面 更新完毕 2023-01-10：根据台式机的安装过程修改和更新更多细节以符合 2023-01-01 镜像安装的过程，增添更多配置过程。本篇博客介绍的安装过程没有使用 arch-install-scripts。  在考研的时候我就在思考，我到底为什么写博客。如果仅仅是展示自己的知识的话，那么我想懂得人并不会有多细看我的博客，而不懂的人也很有可能看不懂。 在又一次折腾完我的 Arch 之后，">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://blog.syize.cn/2021/12/28/install-arch-and-kde/fcitx5.jpg">
<meta property="og:image" content="https://blog.syize.cn/2021/12/28/install-arch-and-kde/oh-my-zsh.png">
<meta property="og:image" content="https://blog.syize.cn/2021/12/28/install-arch-and-kde/desktop.png">
<meta property="og:image" content="https://blog.syize.cn/2021/12/28/install-arch-and-kde/cursor.png">
<meta property="article:published_time" content="2021-12-28T15:02:04.000Z">
<meta property="article:modified_time" content="2023-01-10T07:16:42.802Z">
<meta property="article:author" content="Syize">
<meta property="article:tag" content="Arch">
<meta property="article:tag" content="KDE">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://blog.syize.cn/2021/12/28/install-arch-and-kde/fcitx5.jpg">


    
<link rel="stylesheet" href="/css/style/main.css">
 

    
    
        <link rel="stylesheet" id="hl-default-theme" href="/css/highlight/atom-one-dark.css" media="none" >
        
    

    
    

    
    
<link rel="stylesheet" href="/css/style/dark.css">

    
<script src="/js/darkmode.js"></script>



     

    <!-- custom head -->

<meta name="generator" content="Hexo 5.4.0"></head>

    <body>
        <div id="app" tabindex="-1">
            <header class="header">
    <div class="header__left">
        <a href="/" class="button">
            <span class="logo__text">Syize の blog</span>
        </a>
    </div>
    <div class="header__right">
        
            <div class="navbar__menus">
                
                    <a href="/" class="navbar-menu button">home</a>
                
                    <a href="/tags/" class="navbar-menu button">tags</a>
                
                    <a href="/archives/" class="navbar-menu button">archives</a>
                
                    <a href="/categories/" class="navbar-menu button">categories</a>
                
                    <a href="/about/" class="navbar-menu button">about</a>
                
                    <a href="/friend/" class="navbar-menu button">links</a>
                
            </div>
        
        
        

        
        
    <a href="javaScript:void(0);" id="btn-toggle-dark">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
    </a>


        
            <a class="dropdown-icon button" id="btn-dropdown" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width='24' height='24' fill="none" stroke="currentColor" stroke-width="0.7" stroke-linecap="round" stroke-linejoin="round"><path fill="currentColor" d="M3.314,4.8h13.372c0.41,0,0.743-0.333,0.743-0.743c0-0.41-0.333-0.743-0.743-0.743H3.314c-0.41,0-0.743,0.333-0.743,0.743C2.571,4.467,2.904,4.8,3.314,4.8z M16.686,15.2H3.314c-0.41,0-0.743,0.333-0.743,0.743s0.333,0.743,0.743,0.743h13.372c0.41,0,0.743-0.333,0.743-0.743S17.096,15.2,16.686,15.2z M16.686,9.257H3.314c-0.41,0-0.743,0.333-0.743,0.743s0.333,0.743,0.743,0.743h13.372c0.41,0,0.743-0.333,0.743-0.743S17.096,9.257,16.686,9.257z"></path></svg></a>
            <div class="dropdown-menus" id="dropdown-menus">
                
                    <a href="/" class="dropdown-menu button">home</a>
                
                    <a href="/tags/" class="dropdown-menu button">tags</a>
                
                    <a href="/archives/" class="dropdown-menu button">archives</a>
                
                    <a href="/categories/" class="dropdown-menu button">categories</a>
                
                    <a href="/about/" class="dropdown-menu button">about</a>
                
                    <a href="/friend/" class="dropdown-menu button">links</a>
                
            </div>
        
    </div>
</header>


            <main class="main">
    

<div class="post-title">
    <h1 class="post-title__text">
        Arch Linux, KDE 桌面及各种服务安装过程
    </h1>
    <div class="post-title__meta">
        <a href="/archives/2021/12/" class="post-meta__date button">2021-12-28</a>
        
    <span class="separate-dot"></span><a href="/categories/Arch/" class="button">Arch</a>

 
        
    
    


 

 
    </div>
</div>


    <aside class="post-side">
        <div class="post-side__toc">
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2"><span class="toc-number">1.</span> <span class="toc-text">写在前面</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-number">2.</span> <span class="toc-text">准备工作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E8%BF%87%E7%A8%8B"><span class="toc-number">3.</span> <span class="toc-text">安装过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%97%AD%E7%83%A6%E4%BA%BA%E7%9A%84-beep"><span class="toc-number">3.1.</span> <span class="toc-text">关闭烦人的 beep</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E7%BD%91%E7%BB%9C"><span class="toc-number">3.2.</span> <span class="toc-text">连接网络</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%89%E7%BA%BF%E7%BD%91%E7%BB%9C"><span class="toc-number">3.2.1.</span> <span class="toc-text">有线网络</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E7%BA%BF%E7%BD%91%E7%BB%9C"><span class="toc-number">3.3.</span> <span class="toc-text">无线网络</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E7%B3%BB%E7%BB%9F%E6%97%B6%E9%97%B4"><span class="toc-number">3.4.</span> <span class="toc-text">更新系统时间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A3%81%E7%9B%98%E5%88%86%E5%8C%BA"><span class="toc-number">3.5.</span> <span class="toc-text">磁盘分区</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%82%E8%BD%BD%E5%88%86%E5%8C%BA"><span class="toc-number">3.6.</span> <span class="toc-text">挂载分区</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%BF%85%E9%9C%80%E8%BD%AF%E4%BB%B6%E5%8C%85"><span class="toc-number">3.7.</span> <span class="toc-text">安装必需软件包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90-fstab"><span class="toc-number">3.8.</span> <span class="toc-text">生成 fstab</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E5%85%A5%E5%AE%89%E8%A3%85%E7%9A%84%E7%B3%BB%E7%BB%9F"><span class="toc-number">3.9.</span> <span class="toc-text">进入安装的系统</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E6%97%B6%E5%8C%BA"><span class="toc-number">3.10.</span> <span class="toc-text">设置时区</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E5%8C%96%E8%AE%BE%E7%BD%AE"><span class="toc-number">3.11.</span> <span class="toc-text">本地化设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E8%AE%BE%E7%BD%AE"><span class="toc-number">3.12.</span> <span class="toc-text">网络设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE-root-%E5%AF%86%E7%A0%81"><span class="toc-number">3.13.</span> <span class="toc-text">设置 root 密码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-GRUB-%E5%BC%95%E5%AF%BC"><span class="toc-number">3.14.</span> <span class="toc-text">安装 GRUB 引导</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E9%87%8D%E5%90%AF"><span class="toc-number">3.15.</span> <span class="toc-text">准备重启</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A0%E7%BA%BF%E7%BD%91%E7%BB%9C-1"><span class="toc-number">3.15.1.</span> <span class="toc-text">无线网络</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BB%E9%99%86"><span class="toc-number">3.16.</span> <span class="toc-text">登陆</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E7%BD%91%E7%BB%9C-1"><span class="toc-number">3.17.</span> <span class="toc-text">连接网络</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E5%BD%A2%E7%95%8C%E9%9D%A2%E7%9A%84%E5%AE%89%E8%A3%85"><span class="toc-number">3.18.</span> <span class="toc-text">图形界面的安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E6%99%AE%E9%80%9A%E7%94%A8%E6%88%B7"><span class="toc-number">3.19.</span> <span class="toc-text">添加普通用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E8%BE%93%E5%85%A5%E6%B3%95-fcitx5"><span class="toc-number">3.20.</span> <span class="toc-text">安装输入法 fcitx5</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%AD%97%E4%BD%93"><span class="toc-number">3.21.</span> <span class="toc-text">安装字体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%90%AF"><span class="toc-number">3.22.</span> <span class="toc-text">重启</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AA%E6%80%A7%E5%8C%96"><span class="toc-number">4.</span> <span class="toc-text">个性化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8"><span class="toc-number">4.1.</span> <span class="toc-text">浏览器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E6%96%87%E8%BE%93%E5%85%A5%E6%B3%95"><span class="toc-number">4.2.</span> <span class="toc-text">中文输入法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#emoji"><span class="toc-number">4.3.</span> <span class="toc-text">emoji</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#zsh-%E4%B8%AA%E6%80%A7%E5%8C%96"><span class="toc-number">4.4.</span> <span class="toc-text">zsh 个性化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#zsh-%E6%8F%92%E4%BB%B6"><span class="toc-number">4.5.</span> <span class="toc-text">zsh 插件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95%E9%AB%98%E4%BA%AE"><span class="toc-number">4.5.1.</span> <span class="toc-text">语法高亮</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%A5%E5%85%A8%E5%BB%BA%E8%AE%AE"><span class="toc-number">4.5.2.</span> <span class="toc-text">补全建议</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#KDE-%E9%83%A8%E4%BB%B6"><span class="toc-number">4.6.</span> <span class="toc-text">KDE 部件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Variety"><span class="toc-number">4.7.</span> <span class="toc-text">Variety</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%8D%A2%E9%BC%A0%E6%A0%87"><span class="toc-number">4.8.</span> <span class="toc-text">更换鼠标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sddm-%E4%B8%BB%E9%A2%98%E6%9B%B4%E6%8D%A2"><span class="toc-number">4.9.</span> <span class="toc-text">sddm 主题更换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#grub-%E4%B8%BB%E9%A2%98%E6%9B%B4%E6%8D%A2"><span class="toc-number">4.10.</span> <span class="toc-text">grub 主题更换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dnsmasq-%E5%AE%89%E8%A3%85"><span class="toc-number">4.11.</span> <span class="toc-text">dnsmasq 安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#aria2-%E5%AE%89%E8%A3%85-1"><span class="toc-number">4.12.</span> <span class="toc-text">aria2 安装-1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nginx-%E5%AE%89%E8%A3%85"><span class="toc-number">4.13.</span> <span class="toc-text">nginx 安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#aria2-%E5%AE%89%E8%A3%85-2"><span class="toc-number">4.14.</span> <span class="toc-text">aria2 安装-2</span></a></li></ol></li></ol>
        </div>
    </aside>
    <a class="btn-toc button" id="btn-toc" tabindex="0">
        <svg viewBox="0 0 1024 1024" width="32" height="32" xmlns="http://www.w3.org/2000/svg">
            <path d="M128 256h64V192H128zM320 256h576V192H320zM128 544h64v-64H128zM320 544h576v-64H320zM128 832h64v-64H128zM320 832h576v-64H320z" fill="currentColor"></path>
        </svg>
    </a>
    <div class="toc-menus" id="toc-menus">
        <div class="toc-title">Article Directory</div>
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2"><span class="toc-number">1.</span> <span class="toc-text">写在前面</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-number">2.</span> <span class="toc-text">准备工作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E8%BF%87%E7%A8%8B"><span class="toc-number">3.</span> <span class="toc-text">安装过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%97%AD%E7%83%A6%E4%BA%BA%E7%9A%84-beep"><span class="toc-number">3.1.</span> <span class="toc-text">关闭烦人的 beep</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E7%BD%91%E7%BB%9C"><span class="toc-number">3.2.</span> <span class="toc-text">连接网络</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%89%E7%BA%BF%E7%BD%91%E7%BB%9C"><span class="toc-number">3.2.1.</span> <span class="toc-text">有线网络</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E7%BA%BF%E7%BD%91%E7%BB%9C"><span class="toc-number">3.3.</span> <span class="toc-text">无线网络</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E7%B3%BB%E7%BB%9F%E6%97%B6%E9%97%B4"><span class="toc-number">3.4.</span> <span class="toc-text">更新系统时间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A3%81%E7%9B%98%E5%88%86%E5%8C%BA"><span class="toc-number">3.5.</span> <span class="toc-text">磁盘分区</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%82%E8%BD%BD%E5%88%86%E5%8C%BA"><span class="toc-number">3.6.</span> <span class="toc-text">挂载分区</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%BF%85%E9%9C%80%E8%BD%AF%E4%BB%B6%E5%8C%85"><span class="toc-number">3.7.</span> <span class="toc-text">安装必需软件包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90-fstab"><span class="toc-number">3.8.</span> <span class="toc-text">生成 fstab</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E5%85%A5%E5%AE%89%E8%A3%85%E7%9A%84%E7%B3%BB%E7%BB%9F"><span class="toc-number">3.9.</span> <span class="toc-text">进入安装的系统</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E6%97%B6%E5%8C%BA"><span class="toc-number">3.10.</span> <span class="toc-text">设置时区</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E5%8C%96%E8%AE%BE%E7%BD%AE"><span class="toc-number">3.11.</span> <span class="toc-text">本地化设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E8%AE%BE%E7%BD%AE"><span class="toc-number">3.12.</span> <span class="toc-text">网络设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE-root-%E5%AF%86%E7%A0%81"><span class="toc-number">3.13.</span> <span class="toc-text">设置 root 密码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-GRUB-%E5%BC%95%E5%AF%BC"><span class="toc-number">3.14.</span> <span class="toc-text">安装 GRUB 引导</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E9%87%8D%E5%90%AF"><span class="toc-number">3.15.</span> <span class="toc-text">准备重启</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A0%E7%BA%BF%E7%BD%91%E7%BB%9C-1"><span class="toc-number">3.15.1.</span> <span class="toc-text">无线网络</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BB%E9%99%86"><span class="toc-number">3.16.</span> <span class="toc-text">登陆</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E7%BD%91%E7%BB%9C-1"><span class="toc-number">3.17.</span> <span class="toc-text">连接网络</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E5%BD%A2%E7%95%8C%E9%9D%A2%E7%9A%84%E5%AE%89%E8%A3%85"><span class="toc-number">3.18.</span> <span class="toc-text">图形界面的安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E6%99%AE%E9%80%9A%E7%94%A8%E6%88%B7"><span class="toc-number">3.19.</span> <span class="toc-text">添加普通用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E8%BE%93%E5%85%A5%E6%B3%95-fcitx5"><span class="toc-number">3.20.</span> <span class="toc-text">安装输入法 fcitx5</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%AD%97%E4%BD%93"><span class="toc-number">3.21.</span> <span class="toc-text">安装字体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%90%AF"><span class="toc-number">3.22.</span> <span class="toc-text">重启</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AA%E6%80%A7%E5%8C%96"><span class="toc-number">4.</span> <span class="toc-text">个性化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8"><span class="toc-number">4.1.</span> <span class="toc-text">浏览器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E6%96%87%E8%BE%93%E5%85%A5%E6%B3%95"><span class="toc-number">4.2.</span> <span class="toc-text">中文输入法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#emoji"><span class="toc-number">4.3.</span> <span class="toc-text">emoji</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#zsh-%E4%B8%AA%E6%80%A7%E5%8C%96"><span class="toc-number">4.4.</span> <span class="toc-text">zsh 个性化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#zsh-%E6%8F%92%E4%BB%B6"><span class="toc-number">4.5.</span> <span class="toc-text">zsh 插件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95%E9%AB%98%E4%BA%AE"><span class="toc-number">4.5.1.</span> <span class="toc-text">语法高亮</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%A5%E5%85%A8%E5%BB%BA%E8%AE%AE"><span class="toc-number">4.5.2.</span> <span class="toc-text">补全建议</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#KDE-%E9%83%A8%E4%BB%B6"><span class="toc-number">4.6.</span> <span class="toc-text">KDE 部件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Variety"><span class="toc-number">4.7.</span> <span class="toc-text">Variety</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%8D%A2%E9%BC%A0%E6%A0%87"><span class="toc-number">4.8.</span> <span class="toc-text">更换鼠标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sddm-%E4%B8%BB%E9%A2%98%E6%9B%B4%E6%8D%A2"><span class="toc-number">4.9.</span> <span class="toc-text">sddm 主题更换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#grub-%E4%B8%BB%E9%A2%98%E6%9B%B4%E6%8D%A2"><span class="toc-number">4.10.</span> <span class="toc-text">grub 主题更换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dnsmasq-%E5%AE%89%E8%A3%85"><span class="toc-number">4.11.</span> <span class="toc-text">dnsmasq 安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#aria2-%E5%AE%89%E8%A3%85-1"><span class="toc-number">4.12.</span> <span class="toc-text">aria2 安装-1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nginx-%E5%AE%89%E8%A3%85"><span class="toc-number">4.13.</span> <span class="toc-text">nginx 安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#aria2-%E5%AE%89%E8%A3%85-2"><span class="toc-number">4.14.</span> <span class="toc-text">aria2 安装-2</span></a></li></ol></li></ol>
    </div>


<article class="post post__with-toc content-card">
    <div class="post__header">
    <div class="post__expire" id="post-expired-notify">
        <p>
            This article was last updated on &lt;span id=&#34;expire-date&#34;&gt;&lt;/span&gt; days ago, the information described in the article may be outdated.
        </p>
    </div>
    <script>
        (() => {
            var update = Date.parse("2023-01-10"),
                date = new Date(),
                now = date.getTime(),
                expire = now - update,
                expire_days = Math.floor(expire/(24*3600*1000));
            if (expire_days >= 120) {
                document.querySelectorAll('#expire-date')[0].innerHTML = expire_days;
                document.querySelectorAll('#post-expired-notify')[0].style.display = 'block';
            }
        })();
    </script>
</div>
    <div class="post__content">
        <h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2><blockquote>
<p>更新完毕</p>
<p>2023-01-10：根据台式机的安装过程修改和更新更多细节以符合 2023-01-01 镜像安装的过程，增添更多配置过程。本篇博客介绍的安装过程没有使用 arch-install-scripts。</p>
</blockquote>
<p>在考研的时候我就在思考，我到底为什么写博客。如果仅仅是展示自己的知识的话，那么我想懂得人并不会有多细看我的博客，而不懂的人也很有可能看不懂。</p>
<p>在又一次折腾完我的 Arch 之后，我明白了，我写博客的意义，就是在自己忘掉已经学过的东西之前，将他们梳理出来，做一个备忘。</p>
<p>这是一篇详详细细记录安装 Arch，KDE 并完整个性化的博客。我会一直更新直到描述完全为止。</p>
<span id="more"></span>

<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>首先你需要做好启动盘，ISO 通过 <a target="_blank" rel="noopener" href="https://archlinux.org/download/">官方</a> 的磁力或者种子或者直链下载很快，推荐使用 <a target="_blank" rel="noopener" href="https://www.ventoy.net/cn/index.html">Ventoy</a> 制作，将 ISO 放入安装好的 U盘 即可</p>
<p>然后进入 BIOS 修改你的启动顺序，把 USB 启动放到第一位。可能还需要关闭 security boot。</p>
<p>我的机器是 UEFI 启动，非 UEFI 的请自行判断</p>
<h2 id="安装过程"><a href="#安装过程" class="headerlink" title="安装过程"></a>安装过程</h2><blockquote>
<p>以下步骤绝大部分参考了 <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/157260502">来自知乎的教程</a> ，并在安装过程中根据实际情况进行了修改</p>
</blockquote>
<h3 id="关闭烦人的-beep"><a href="#关闭烦人的-beep" class="headerlink" title="关闭烦人的 beep"></a>关闭烦人的 beep</h3><p>每次我 tab 不好都会来一声。<del>关掉！一定要关掉！</del></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rmmod pcspkr</span><br></pre></td></tr></table></figure>

<h3 id="连接网络"><a href="#连接网络" class="headerlink" title="连接网络"></a>连接网络</h3><p>首先需要给网卡上电</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rfkill unblock all</span><br></pre></td></tr></table></figure>

<p>然后需要开启 <code>DHCP</code> 服务，以及域名解析服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start dhcpcd</span><br><span class="line">systemctl start systemd-resolved</span><br></pre></td></tr></table></figure>

<h4 id="有线网络"><a href="#有线网络" class="headerlink" title="有线网络"></a>有线网络</h4><p>如果是通过网线或者手机 USB 共享的网络，此时已经连接上网络了，检验命令如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping www.baidu.com -c 5</span><br></pre></td></tr></table></figure>

<h3 id="无线网络"><a href="#无线网络" class="headerlink" title="无线网络"></a>无线网络</h3><p>使用 iwd 连接网络</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iwctl	<span class="comment"># 进入 iwd 的命令行</span></span><br></pre></td></tr></table></figure>

<p>以下命令是在 iwctl 中使用的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">device list		# 查看你的网卡有哪些，我的是 wlan0</span><br><span class="line"></span><br><span class="line"># 以下命令请将 wlan0 替换为你的网卡名称</span><br><span class="line">station wlan0 scan		# 扫描无线网络</span><br><span class="line">station wlan0 get-networks	# 获取扫描结果</span><br><span class="line">station wlan0 connect 网络名称	# 连接到网络</span><br></pre></td></tr></table></figure>

<h3 id="更新系统时间"><a href="#更新系统时间" class="headerlink" title="更新系统时间"></a>更新系统时间</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">timedatectl set-ntp <span class="literal">true</span></span><br><span class="line">timedatectl status</span><br></pre></td></tr></table></figure>

<p>我这里显示的是世界时。显示时间不对没关系，不影响安装。</p>
<h3 id="磁盘分区"><a href="#磁盘分区" class="headerlink" title="磁盘分区"></a>磁盘分区</h3><p>首先要搞清楚在哪一块磁盘上安装</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsblk</span><br></pre></td></tr></table></figure>

<p>然后使用 fdisk 进行分区</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fdisk /dev/nvme0n1	<span class="comment"># nvme0n1 是我的磁盘名称，请替换为上面 lsblk 显示的结果</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>tips: fdisk 使用字节计算大小，将 G 换算为 字节时要乘 1024*2048</p>
</blockquote>
<p>详细分区及格式化步骤略过，仅提一句 swap 分区的格式化</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkswap /path/to/swap	<span class="comment"># 格式化</span></span><br><span class="line">swapon /path/to/swap	<span class="comment"># 启用</span></span><br><span class="line">free -h		<span class="comment"># 查看是否启用成功</span></span><br></pre></td></tr></table></figure>

<h3 id="挂载分区"><a href="#挂载分区" class="headerlink" title="挂载分区"></a>挂载分区</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mount /path/to/root /mnt	<span class="comment"># 挂载 root 分区</span></span><br><span class="line"><span class="comment"># 挂载 home</span></span><br><span class="line">mkdir /mnt/home</span><br><span class="line">mount /path/to/home /mnt/home</span><br><span class="line"><span class="comment"># 挂载 EFI</span></span><br><span class="line">mkdir /mnt/efi</span><br><span class="line">mount /path/to/efi /mnt/efi</span><br></pre></td></tr></table></figure>

<h3 id="安装必需软件包"><a href="#安装必需软件包" class="headerlink" title="安装必需软件包"></a>安装必需软件包</h3><blockquote>
<p>顺便把一会要用的都给装了</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacstrap /mnt base linux linux-firmware vim iwd dhcpcd</span><br></pre></td></tr></table></figure>

<h3 id="生成-fstab"><a href="#生成-fstab" class="headerlink" title="生成 fstab"></a>生成 fstab</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">genfstab -U /mnt &gt;&gt; /mnt/etc/fstab</span><br></pre></td></tr></table></figure>

<p>如果要为 home 分区 (btrfs 格式) 启用透明压缩，编辑 <code>/mnt/etc/fstab</code> 文件并在 <code>/home</code> 的配置行修改，在下列配置的最后添加 <code>compress=zstd</code> 选项。</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rw,relatime,ssd,space_cache,<span class="attribute">subvolid</span>=5,subvol=/,compress=zstd</span><br></pre></td></tr></table></figure>

<h3 id="进入安装的系统"><a href="#进入安装的系统" class="headerlink" title="进入安装的系统"></a>进入安装的系统</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arch-chroot /mnt</span><br></pre></td></tr></table></figure>

<h3 id="设置时区"><a href="#设置时区" class="headerlink" title="设置时区"></a>设置时区</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br></pre></td></tr></table></figure>

<p>将硬件时钟调整为与目前的时钟一致</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hwclock --systohc</span><br></pre></td></tr></table></figure>

<h3 id="本地化设置"><a href="#本地化设置" class="headerlink" title="本地化设置"></a>本地化设置</h3><blockquote>
<p>注意不是个性化</p>
</blockquote>
<ol>
<li>编辑 /etc/locale.gen 并将 en_US.UTF-8 和 zh_CN.UTF-8 取消注释</li>
<li>执行 locale-gen 命令生成 locale</li>
<li>创建 /etc/locale.conf 并添加变量 LANG</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LANG=en_US.UTF-8</span><br></pre></td></tr></table></figure>

<p><strong>最好不要设置为中文的 locale，会导致终端乱码</strong></p>
<h3 id="网络设置"><a href="#网络设置" class="headerlink" title="网络设置"></a>网络设置</h3><ol>
<li>创建 /etc/hostname 并为你的电脑命名</li>
<li>配置 /etc/hosts ，内容如下</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1	localhost</span><br><span class="line">::1			localhost</span><br></pre></td></tr></table></figure>

<h3 id="设置-root-密码"><a href="#设置-root-密码" class="headerlink" title="设置 root 密码"></a>设置 root 密码</h3><p>执行 passwd 即可</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd</span><br></pre></td></tr></table></figure>

<h3 id="安装-GRUB-引导"><a href="#安装-GRUB-引导" class="headerlink" title="安装 GRUB 引导"></a>安装 GRUB 引导</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacman -S grub efibootmgr</span><br></pre></td></tr></table></figure>

<blockquote>
<p>grub 可以安装主题将难看的黑白界面换掉，个性化会提到</p>
</blockquote>
<p>将 grub 安装到系统</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grub-install --target=x86_64-efi --efi-directory=/efi --bootloader-id=ArchLinux</span><br></pre></td></tr></table></figure>

<p>生成配置文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grub-mkconfig -o /boot/grub/grub.cfg</span><br></pre></td></tr></table></figure>

<h3 id="准备重启"><a href="#准备重启" class="headerlink" title="准备重启"></a>准备重启</h3><h4 id="无线网络-1"><a href="#无线网络-1" class="headerlink" title="无线网络"></a>无线网络</h4><p>首先配置 iwd</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 编辑文件 /etc/iwd/main.conf，并加入下面两行内容</span><br><span class="line">[General]</span><br><span class="line">EnableNetworkConfiguration=true</span><br></pre></td></tr></table></figure>

<p>然后启用与网络相关的服务</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启用 systemd-resolved 服务</span></span><br><span class="line">systemctl <span class="built_in">enable</span> systemd-resolved.service</span><br><span class="line"><span class="comment"># iwd 开机自启动</span></span><br><span class="line">systemctl <span class="built_in">enable</span> iwd.service</span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span>	<span class="comment"># 退出 chroot 环境</span></span><br><span class="line">umount -R /mnt	<span class="comment"># 卸载分区</span></span><br><span class="line">reboot	<span class="comment"># 重启</span></span><br></pre></td></tr></table></figure>

<h3 id="登陆"><a href="#登陆" class="headerlink" title="登陆"></a>登陆</h3><p>用户名为 root，密码为刚刚设置的密码。</p>
<h3 id="连接网络-1"><a href="#连接网络-1" class="headerlink" title="连接网络"></a>连接网络</h3><p>步骤同开头的步骤，这里略过</p>
<h3 id="图形界面的安装"><a href="#图形界面的安装" class="headerlink" title="图形界面的安装"></a>图形界面的安装</h3><p>安装显示服务器 xorg</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacman -S org</span><br></pre></td></tr></table></figure>

<p>安装显卡驱动</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pacman -Ss xf86-video	<span class="comment"># 查看都有哪些驱动</span></span><br><span class="line"><span class="comment"># 我只有一个 AMD 的显卡，所以安装 xf86-video-amdgpu</span></span><br><span class="line">pacman -S xf86-video-amdgpu mesa vulkan-radeon libva-mesa-driver mesa-vdpau</span><br></pre></td></tr></table></figure>

<p>安装桌面环境，我选择 KDE 的 plasma，美化效果一级棒</p>
<p>arch 仓库里有两个组</p>
<ol>
<li> plasma-meta，这个包会将所有 plasma 桌面用到的东西都给你装上，不过我不太喜欢，因为有一些包我用不到，就白白浪费空间 (我的 root 分区只给了 20G)。</li>
<li>plasma-desktop，这个是最小化安装，也就是能跑起来图形界面，但是各种其他组件需要自己安装</li>
</ol>
<p>我安装的是 plasma-desktop，以及下列其他一些组件</p>
<ol>
<li>plasma-pa：KDE 的音频管理组件</li>
<li>plasma-nm：KDE 的网络管理器，使用 wpa_supplicant 做后端，也就是说安装完成以后之前装的 iwd 可以删掉了</li>
<li>powerdevil 和 acpid：电源管理，没有它我不能调节笔记本的屏幕亮度</li>
<li>bluez：蓝牙管理</li>
<li>kscreen：屏幕管理，调节分辨率和缩放的。</li>
<li>khotkeys：快捷键</li>
<li>konsole：KDE 的终端模拟器。</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacman -S plasma-desktop plasma-pa plasma-nm powerdevil acpid bluez kscreen khotkeys konsole</span><br></pre></td></tr></table></figure>

<p>安装显示管理器，sddm比较好看，还可以换主题</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pacman -S sddm</span><br><span class="line"><span class="comment"># 设置开机启动</span></span><br><span class="line">systemctl <span class="built_in">enable</span> sddm.service</span><br></pre></td></tr></table></figure>

<h3 id="添加普通用户"><a href="#添加普通用户" class="headerlink" title="添加普通用户"></a>添加普通用户</h3><blockquote>
<p>以下请将 syize 换成你的用户名</p>
</blockquote>
<p>root 用户是不能通过 sddm 登陆进入桌面的</p>
<p>由于我使用 zsh 而不是 bash，需要先安装 zsh</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacman -S zsh</span><br></pre></td></tr></table></figure>

<blockquote>
<p>zsh 可以通过 oh-my-zsh 进行美化</p>
</blockquote>
<p>创建用户组</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groupadd syize</span><br></pre></td></tr></table></figure>

<p>创建用户</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd -m -g syize -s /usr/bin/zsh syize</span><br></pre></td></tr></table></figure>

<p>设置普通用户设置密码</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd syize</span><br></pre></td></tr></table></figure>

<p>赋予 sudo 权限</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacman -S sudo	<span class="comment"># 安装 sudo 包</span></span><br></pre></td></tr></table></figure>

<p>编辑 /etc/sudoers 并加入下面的内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 需要在 root ALL=(ALL) ALL 下面一行插入</span><br><span class="line">syize ALL=(ALL) ALL</span><br></pre></td></tr></table></figure>

<p>vim 的话需要用 :w! 强制保存</p>
<h3 id="安装输入法-fcitx5"><a href="#安装输入法-fcitx5" class="headerlink" title="安装输入法 fcitx5"></a>安装输入法 fcitx5</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacman -S fcitx5 fcitx5-chinese-addons fcitx5-gtk fcitx5-qt fcitx5-configtool fcitx5-pinyin-zhwiki fcitx5-table-extra</span><br></pre></td></tr></table></figure>

<p>配置环境变量</p>
<blockquote>
<p>这些东西可以先跳过，在你启动到图形界面以后复制粘贴</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/environment</span><br></pre></td></tr></table></figure>

<p>加入下面的内容</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">GTK_IM_MODULE</span>=fcitx</span><br><span class="line"><span class="attr">QT_IM_MODULE</span>=fcitx</span><br><span class="line"><span class="attr">XMODIFIERS</span>=\@im=fcitx</span><br><span class="line"><span class="attr">SDL_IM_MODULE</span>=fcitx</span><br><span class="line"><span class="attr">INPUT_METHOD</span>=fcitx</span><br><span class="line"><span class="attr">GLFW_IM_MODULE</span>=fcitx</span><br></pre></td></tr></table></figure>

<h3 id="安装字体"><a href="#安装字体" class="headerlink" title="安装字体"></a>安装字体</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pacman -S ttf-dejavu	<span class="comment"># 英文字体</span></span><br><span class="line">pacman -S wqy-microhei	<span class="comment"># 中文字体</span></span><br></pre></td></tr></table></figure>

<h3 id="重启"><a href="#重启" class="headerlink" title="重启"></a>重启</h3><p>到目前为止就装的差不多了，重启即可进入桌面了</p>
<p>由于不再使用 iwd，可以将其删除，并将 NetworkManager 设置开机启动</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -Rs iwd</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> NetworkManager</span><br></pre></td></tr></table></figure>

<h2 id="个性化"><a href="#个性化" class="headerlink" title="个性化"></a>个性化</h2><h3 id="浏览器"><a href="#浏览器" class="headerlink" title="浏览器"></a>浏览器</h3><p><del>没有浏览器，你们怎么看我的教程</del></p>
<p>仓库里没有我喜爱的 chrome，可以先安装 firefox 凑活用一下</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S firefox firefox-i18n-zh-cn</span><br></pre></td></tr></table></figure>

<h3 id="中文输入法"><a href="#中文输入法" class="headerlink" title="中文输入法"></a>中文输入法</h3><p><del>没有输入法，你们怎么给我评论</del></p>
<p>由于之前安装过了 fcitx5，直接在 系统设置-&gt;区域设置 里面就能找到输入法设置，键盘配置如图</p>
<img src="/2021/12/28/install-arch-and-kde/fcitx5.jpg" class="">

<p>如果你前面没有配置环境变量，需要配置一下</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/environment</span><br></pre></td></tr></table></figure>

<p>加入下面的内容</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">GTK_IM_MODULE</span>=fcitx</span><br><span class="line"><span class="attr">QT_IM_MODULE</span>=fcitx</span><br><span class="line"><span class="attr">XMODIFIERS</span>=\@im=fcitx</span><br><span class="line"><span class="attr">SDL_IM_MODULE</span>=fcitx</span><br><span class="line"><span class="attr">INPUT_METHOD</span>=fcitx</span><br><span class="line"><span class="attr">GLFW_IM_MODULE</span>=fcitx</span><br></pre></td></tr></table></figure>

<h3 id="emoji"><a href="#emoji" class="headerlink" title="emoji"></a>emoji</h3><p>为了能打出流汗黄豆，我们需要安装 emoji 字体</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S noto-fonts-emoji	<span class="comment"># emoji</span></span><br></pre></td></tr></table></figure>

<p>还需要配置一下 emoji 让其正常显示。编辑 /etc/fonts/conf.d/75-noto-color-emoji.conf，加入下面的内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">fontconfig</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;fonts.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">fontconfig</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Add generic family. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">match</span> <span class="attr">target</span>=<span class="string">&quot;pattern&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">test</span> <span class="attr">qual</span>=<span class="string">&quot;any&quot;</span> <span class="attr">name</span>=<span class="string">&quot;family&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>emoji<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">test</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">edit</span> <span class="attr">name</span>=<span class="string">&quot;family&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;assign&quot;</span> <span class="attr">binding</span>=<span class="string">&quot;same&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>Noto Color Emoji<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">edit</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">match</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- This adds Noto Color Emoji as a final fallback font for the default font families. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">match</span> <span class="attr">target</span>=<span class="string">&quot;pattern&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">test</span> <span class="attr">name</span>=<span class="string">&quot;family&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>sans<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">test</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">edit</span> <span class="attr">name</span>=<span class="string">&quot;family&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;append&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>Noto Color Emoji<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">edit</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">match</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">match</span> <span class="attr">target</span>=<span class="string">&quot;pattern&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">test</span> <span class="attr">name</span>=<span class="string">&quot;family&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>serif<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">test</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">edit</span> <span class="attr">name</span>=<span class="string">&quot;family&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;append&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>Noto Color Emoji<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">edit</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">match</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">match</span> <span class="attr">target</span>=<span class="string">&quot;pattern&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">test</span> <span class="attr">name</span>=<span class="string">&quot;family&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>sans-serif<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">test</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">edit</span> <span class="attr">name</span>=<span class="string">&quot;family&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;append&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>Noto Color Emoji<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">edit</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">match</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">match</span> <span class="attr">target</span>=<span class="string">&quot;pattern&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">test</span> <span class="attr">name</span>=<span class="string">&quot;family&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>monospace<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">test</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">edit</span> <span class="attr">name</span>=<span class="string">&quot;family&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;append&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>Noto Color Emoji<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">edit</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">match</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Block Symbola from the list of fallback fonts. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">selectfont</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rejectfont</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">patelt</span> <span class="attr">name</span>=<span class="string">&quot;family&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">string</span>&gt;</span>Symbola<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">patelt</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rejectfont</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">selectfont</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Use Noto Color Emoji when other popular fonts are being specifically requested. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">match</span> <span class="attr">target</span>=<span class="string">&quot;pattern&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">test</span> <span class="attr">qual</span>=<span class="string">&quot;any&quot;</span> <span class="attr">name</span>=<span class="string">&quot;family&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>Apple Color Emoji<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">test</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">edit</span> <span class="attr">name</span>=<span class="string">&quot;family&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;assign&quot;</span> <span class="attr">binding</span>=<span class="string">&quot;same&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>Noto Color Emoji<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">edit</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">match</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">match</span> <span class="attr">target</span>=<span class="string">&quot;pattern&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">test</span> <span class="attr">qual</span>=<span class="string">&quot;any&quot;</span> <span class="attr">name</span>=<span class="string">&quot;family&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>Segoe UI Emoji<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">test</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">edit</span> <span class="attr">name</span>=<span class="string">&quot;family&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;assign&quot;</span> <span class="attr">binding</span>=<span class="string">&quot;same&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>Noto Color Emoji<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">edit</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">match</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">match</span> <span class="attr">target</span>=<span class="string">&quot;pattern&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">test</span> <span class="attr">qual</span>=<span class="string">&quot;any&quot;</span> <span class="attr">name</span>=<span class="string">&quot;family&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>Segoe UI Symbol<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">test</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">edit</span> <span class="attr">name</span>=<span class="string">&quot;family&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;assign&quot;</span> <span class="attr">binding</span>=<span class="string">&quot;same&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>Noto Color Emoji<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">edit</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">match</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">match</span> <span class="attr">target</span>=<span class="string">&quot;pattern&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">test</span> <span class="attr">qual</span>=<span class="string">&quot;any&quot;</span> <span class="attr">name</span>=<span class="string">&quot;family&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>Android Emoji<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">test</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">edit</span> <span class="attr">name</span>=<span class="string">&quot;family&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;assign&quot;</span> <span class="attr">binding</span>=<span class="string">&quot;same&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>Noto Color Emoji<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">edit</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">match</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">match</span> <span class="attr">target</span>=<span class="string">&quot;pattern&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">test</span> <span class="attr">qual</span>=<span class="string">&quot;any&quot;</span> <span class="attr">name</span>=<span class="string">&quot;family&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>Twitter Color Emoji<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">test</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">edit</span> <span class="attr">name</span>=<span class="string">&quot;family&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;assign&quot;</span> <span class="attr">binding</span>=<span class="string">&quot;same&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>Noto Color Emoji<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">edit</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">match</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">match</span> <span class="attr">target</span>=<span class="string">&quot;pattern&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">test</span> <span class="attr">qual</span>=<span class="string">&quot;any&quot;</span> <span class="attr">name</span>=<span class="string">&quot;family&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>Twemoji<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">test</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">edit</span> <span class="attr">name</span>=<span class="string">&quot;family&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;assign&quot;</span> <span class="attr">binding</span>=<span class="string">&quot;same&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>Noto Color Emoji<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">edit</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">match</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">match</span> <span class="attr">target</span>=<span class="string">&quot;pattern&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">test</span> <span class="attr">qual</span>=<span class="string">&quot;any&quot;</span> <span class="attr">name</span>=<span class="string">&quot;family&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>Twemoji Mozilla<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">test</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">edit</span> <span class="attr">name</span>=<span class="string">&quot;family&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;assign&quot;</span> <span class="attr">binding</span>=<span class="string">&quot;same&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>Noto Color Emoji<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">edit</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">match</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">match</span> <span class="attr">target</span>=<span class="string">&quot;pattern&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">test</span> <span class="attr">qual</span>=<span class="string">&quot;any&quot;</span> <span class="attr">name</span>=<span class="string">&quot;family&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>TwemojiMozilla<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">test</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">edit</span> <span class="attr">name</span>=<span class="string">&quot;family&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;assign&quot;</span> <span class="attr">binding</span>=<span class="string">&quot;same&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>Noto Color Emoji<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">edit</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">match</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">match</span> <span class="attr">target</span>=<span class="string">&quot;pattern&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">test</span> <span class="attr">qual</span>=<span class="string">&quot;any&quot;</span> <span class="attr">name</span>=<span class="string">&quot;family&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>EmojiTwo<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">test</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">edit</span> <span class="attr">name</span>=<span class="string">&quot;family&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;assign&quot;</span> <span class="attr">binding</span>=<span class="string">&quot;same&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>Noto Color Emoji<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">edit</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">match</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">match</span> <span class="attr">target</span>=<span class="string">&quot;pattern&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">test</span> <span class="attr">qual</span>=<span class="string">&quot;any&quot;</span> <span class="attr">name</span>=<span class="string">&quot;family&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>Emoji Two<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">test</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">edit</span> <span class="attr">name</span>=<span class="string">&quot;family&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;assign&quot;</span> <span class="attr">binding</span>=<span class="string">&quot;same&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>Noto Color Emoji<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">edit</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">match</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">match</span> <span class="attr">target</span>=<span class="string">&quot;pattern&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">test</span> <span class="attr">qual</span>=<span class="string">&quot;any&quot;</span> <span class="attr">name</span>=<span class="string">&quot;family&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>EmojiSymbols<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">test</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">edit</span> <span class="attr">name</span>=<span class="string">&quot;family&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;assign&quot;</span> <span class="attr">binding</span>=<span class="string">&quot;same&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>Noto Color Emoji<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">edit</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">match</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">match</span> <span class="attr">target</span>=<span class="string">&quot;pattern&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">test</span> <span class="attr">qual</span>=<span class="string">&quot;any&quot;</span> <span class="attr">name</span>=<span class="string">&quot;family&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>Symbola<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">test</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">edit</span> <span class="attr">name</span>=<span class="string">&quot;family&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;assign&quot;</span> <span class="attr">binding</span>=<span class="string">&quot;same&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>Noto Color Emoji<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">edit</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">match</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">fontconfig</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="zsh-个性化"><a href="#zsh-个性化" class="headerlink" title="zsh 个性化"></a>zsh 个性化</h3><p>默认的 zsh 很丑，需要 oh-my-zsh 来 <del>给它整容</del></p>
<p>网络上的教程是需要自己 curl 脚本安装，幸运的是我们有 archlinuxcn 仓库</p>
<p>首先确认一下自己的 localtime 是否正常。<del>某张姓人士被我带的又趟了一遍坑后得到的教训</del></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo timedatectl status</span><br></pre></td></tr></table></figure>

<p>如果不对，去系统设置里面更改一下时区，等系统时间正常后进行下面的操作。</p>
<p>编辑 /etc/pacman.conf 并加入下面三行来添加仓库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Arch Linux CN</span><br><span class="line">[archlinuxcn]</span><br><span class="line">Server = https://repo.archlinuxcn.org/$arch</span><br></pre></td></tr></table></figure>

<p>还需到导入 GPG 的 key 才行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S archlinuxcn-keyring</span><br></pre></td></tr></table></figure>

<p>更新，并安装 oh-my-zsh-git 和 git</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -Sy &amp;&amp; sudo pacman -S oh-my-zsh-git git</span><br></pre></td></tr></table></figure>

<p>使用 oh-my-zsh 的 zshrc 替换原来的 .zshrc</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/share/oh-my-zsh/zshrc ~/.zshrc</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果你有重要的设置请注意保存</p>
</blockquote>
<p>oh-my-zsh 默认的主题其实比较好看了，但是我更喜欢 amuse</p>
<p>编辑 ~/.zshrc，将 theme 改为 amuse</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZSH_THEME=&quot;amuse&quot;</span><br></pre></td></tr></table></figure>

<p>执行下面的命令看一看效果吧</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/.zshrc</span><br></pre></td></tr></table></figure>

<h3 id="zsh-插件"><a href="#zsh-插件" class="headerlink" title="zsh 插件"></a>zsh 插件</h3><h4 id="语法高亮"><a href="#语法高亮" class="headerlink" title="语法高亮"></a>语法高亮</h4><p>可以提示你敲的命令是否正确。根据官方安装方式</p>
<blockquote>
<p>可能需要科学上网</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo git <span class="built_in">clone</span> https://github.com/zsh-users/zsh-syntax-highlighting.git /usr/share/oh-my-zsh/custom/plugins/zsh-syntax-highlighting</span><br></pre></td></tr></table></figure>

<p>编辑 ~/.zshrc 在 plugin 里面添加进去</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">plugins=(</span><br><span class="line">	# other plugins</span><br><span class="line">	zsh-syntax-highlighting)</span><br></pre></td></tr></table></figure>

<h4 id="补全建议"><a href="#补全建议" class="headerlink" title="补全建议"></a>补全建议</h4><p>以淡色字体显示，根据最近敲击的命令对命令进行建议，减少重复敲键盘次数</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo git <span class="built_in">clone</span> https://github.com/zsh-users/zsh-autosuggestions /usr/share/oh-my-zsh/custom/plugins/zsh-autosuggestions</span><br></pre></td></tr></table></figure>

<p>添加进 .zshrc</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">plugins=(</span><br><span class="line">	# other plugins</span><br><span class="line">	zsh-autosuggestions)</span><br></pre></td></tr></table></figure>

<p>最后效果图</p>
<img src="/2021/12/28/install-arch-and-kde/oh-my-zsh.png" class="">

<h3 id="KDE-部件"><a href="#KDE-部件" class="headerlink" title="KDE 部件"></a>KDE 部件</h3><p>按照上面的流程下来的话就已经有比较多的小部件了，但是没有我想要的便利贴。安装下面的包获得便利贴和更多的部件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S kwidgetsaddons kdeplasma-addons</span><br></pre></td></tr></table></figure>

<p>还有一些监控系统系统信息的比如网络速度，内存使用情况等。</p>
<img src="/2021/12/28/install-arch-and-kde/desktop.png" class="">

<blockquote>
<p>便利贴没有半透明的效果，稍微有点格格不入</p>
</blockquote>
<p>spectacle 是 kde 的截图工具</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S spectacle</span><br></pre></td></tr></table></figure>

<h3 id="Variety"><a href="#Variety" class="headerlink" title="Variety"></a>Variety</h3><p>Variety 可以自动切换壁纸，选择一些你喜欢的照片，然后让它定时更换。作为老虚荣玩家 (<del>泪目</del>)，当然是虚荣美美的英雄皮肤高清原图了</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S variety</span><br></pre></td></tr></table></figure>

<h3 id="更换鼠标"><a href="#更换鼠标" class="headerlink" title="更换鼠标"></a>更换鼠标</h3><p>bibata-cursor-theme 包含多个可以更换的鼠标皮肤</p>
<img src="/2021/12/28/install-arch-and-kde/cursor.png" class="">

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S bibata-cursor-theme</span><br></pre></td></tr></table></figure>

<h3 id="sddm-主题更换"><a href="#sddm-主题更换" class="headerlink" title="sddm 主题更换"></a>sddm 主题更换</h3><p>默认的蓝色登录界面太丑了，KDE Store 的 <a target="_blank" rel="noopener" href="https://store.kde.org/p/1272122">Sugar Dark for SDDM</a> 看起来非常的优雅，并且我将后面的壁纸换成了 <a target="_blank" rel="noopener" href="https://zh.moegirl.org.cn/index.php?title=%E6%A2%85%E5%85%B0%E5%A6%AE&variant=zh-cn&mobileaction=toggle_view_desktop">梅兰妮</a> 万圣节🎃皮肤，颜色非常搭。</p>
<p>想要从系统设置里直接更改 sddm 的登录界面，你需要安装 kcm 包</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S sddm-kcm</span><br></pre></td></tr></table></figure>

<p>不过对于我来说让系统设置下太慢了，我还是手动下载安装的好</p>
<ol>
<li>去 KDE Store 下载主题包</li>
<li>解压到  /usr/share/sddm/themes</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -zxvf sugar-dark.tar.gz -C  /usr/share/sddm/themes</span><br></pre></td></tr></table></figure>

<p>如果你不想用默认的壁纸，准备一个 2400*1600 的 jpg 图片，替换掉 /usr/share/sddm/themes/suger-dark 下的Background.jpg</p>
<p>之后就可以在系统设置里面更改了。注销重新登录就可以看到效果了</p>
<h3 id="grub-主题更换"><a href="#grub-主题更换" class="headerlink" title="grub 主题更换"></a>grub 主题更换</h3><p>我一直用的是 <a target="_blank" rel="noopener" href="https://draculatheme.com/grub">dracula 的主题</a> 。他们的网站上还有很多用于其他应用的主题，强烈推荐。不过似乎 Libreoffice 的主题不能用，好像也没人修</p>
<ol>
<li>下载文件压缩包并解压：<a target="_blank" rel="noopener" href="https://github.com/dracula/grub/archive/master.zip">地址</a></li>
<li>将文件夹放入 /usr/share/grub/themes/</li>
<li>修改 /etc/default/grub 中的主题，改为如下 (应该是在 47 行左右)</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRUB_THEME=&quot;/usr/share/grub/themes/dracula/theme.txt&quot;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>重新生成 grub 配置文件</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo grub-mkconfig -o /boot/grub/grub.cfg</span><br></pre></td></tr></table></figure>

<p>如果你觉得字体过小，则需要重新设置一下 grub 的分辨率。例如我的电脑 grub 推荐 2560x1600，但是我改小到 1280x960 字体才正常大小</p>
<ol>
<li>查看支持的分辨率选项。在 grub 界面按 c 键进入命令模式，输入 videoinfo 查看可用分辨率。</li>
<li>挑一个小的，编辑 /etc/default/grub，并更改如下</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 分辨率改为你自己的，注意中间的 &quot;x&quot; 是小写字母 x</span><br><span class="line">GRUB_GFXMODE=&quot;1280x960&quot;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>重新生成配置文件</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo grub-mkconfig -o /boot/grub/grub.cfg</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>重启查看效果</li>
</ol>
<h3 id="dnsmasq-安装"><a href="#dnsmasq-安装" class="headerlink" title="dnsmasq 安装"></a>dnsmasq 安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S dnsmasq</span><br></pre></td></tr></table></figure>

<p>停用 <code>systemd-resolved</code> 并启用 <code>dnsmasq</code>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">disable</span> --now systemd-resolved</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> --now dnsmasq</span><br></pre></td></tr></table></figure>

<p><code>NetworkManager</code> 会修改 <code>/etc/resolv.conf</code> ，但是我们想要其里面的内容保持固定，因此需要额外配置 <code>NetworkManager</code>。编辑  <code>/etc/NetworkManager/NetworkManager.conf</code> 并添加以下内容：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[main]</span></span><br><span class="line"><span class="attr">dns</span>=none</span><br><span class="line"><span class="attr">rc-manager</span>=unmanaged</span><br></pre></td></tr></table></figure>

<p>然后重启 <code>NetworkManager</code>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart NetworkManager</span><br></pre></td></tr></table></figure>

<p>编辑 <code>/etc/dnsmasq.conf</code>，取消注释修改以下配置：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">strict-<span class="keyword">order</span></span><br><span class="line">listen-address=127.0.0.1</span><br><span class="line"><span class="keyword">log</span>-queries</span><br><span class="line"><span class="keyword">log</span>-facility=/<span class="keyword">var</span>/<span class="keyword">log</span>/dnsmasq/dnsmasq.<span class="keyword">log</span></span><br><span class="line"><span class="keyword">conf</span>-<span class="keyword">dir</span>=/etc/dnsmasq.<span class="keyword">d</span></span><br></pre></td></tr></table></figure>

<p>创建日志文件夹和配置文件文件夹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /var/<span class="built_in">log</span>/dnsmasq</span><br><span class="line">sudo mkdir /etc/dnsmasq.d</span><br></pre></td></tr></table></figure>

<p><code>Github</code> 上有用于 <code>dnsmasq</code> 的 <a target="_blank" rel="noopener" href="https://github.com/felixonmars/dnsmasq-china-list">特殊配置文件</a>，我选用了其中三个：</p>
<ul>
<li>adblock-for-dnsmasq.conf </li>
<li>bogus-nxdomain.china.conf </li>
<li>google.china.conf</li>
</ul>
<p>将文件下载放置到目录 <code>/etc/dnsmasq.d</code> 下即可。</p>
<p>编辑 <code>/etc/resolv.conf</code>，修改 <code>nameserver</code> 地址如下：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">nameserver</span>      <span class="number">127.0.0.1</span></span><br><span class="line">nameserver      <span class="number">8.8.8.8</span></span><br><span class="line">nameserver      <span class="number">114.114.114.114</span></span><br></pre></td></tr></table></figure>

<p>为了防止文件被修改，修改其权限</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chattr +i <span class="regexp">/etc/</span>resolv.conf</span><br></pre></td></tr></table></figure>

<p>最后重启 <code>dnsmasq</code></p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">sudo systemctl restart dnsmasq</span></span><br></pre></td></tr></table></figure>

<p>安装 <code>bind</code> 包，里面有 <code>dig</code> 命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S <span class="built_in">bind</span></span><br></pre></td></tr></table></figure>

<p>然后运行下列命令检验 <code>dnsmasq</code> 是否工作正常</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dig www.baidu.com</span><br></pre></td></tr></table></figure>

<p>只要 SERVER 显示为 127.0.0.1 即表明 <code>dnsmasq</code> 工作正常。</p>
<h3 id="aria2-安装-1"><a href="#aria2-安装-1" class="headerlink" title="aria2 安装-1"></a>aria2 安装-1</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S aria2</span><br></pre></td></tr></table></figure>

<p>aria2 只是一个命令行程序，github 上有许多好用的前端。我选择了 <a target="_blank" rel="noopener" href="https://github.com/mayswind/AriaNg">AriaNg</a>，并决定安装 nginx 来将其部署在本地。</p>
<h3 id="nginx-安装"><a href="#nginx-安装" class="headerlink" title="nginx 安装"></a>nginx 安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S nginx</span><br></pre></td></tr></table></figure>

<p>然后编辑 <code>/etc/nginx/nginx.conf</code>，在第31行下添加如下配置</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">types_hash_max_size</span> <span class="number">2048</span>;</span><br><span class="line"><span class="attribute">types_hash_bucket_size</span> <span class="number">128</span>;</span><br><span class="line"><span class="attribute">include</span> conf.d/<span class="regexp">*.conf</span>;</span><br></pre></td></tr></table></figure>

<p>include 配置使得 nginx 可以读取 <code>/etc/nginx/conf.d</code> 目录下的所有配置文件。编写 AriaNg 的配置文件。</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">server_name</span> aria2.syize.local; <span class="comment"># 域名可以自由更换</span></span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="attribute">root</span> /usr/share/nginx/html/aria2-ng;</span><br><span class="line">    <span class="attribute">index</span> index.html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重启 <code>nginx</code>，将下载的 AriaNg 网页文件放置在上面 root 对应的路径下即可。为了能使对应的域名被解析到本地，需要在 <code>dnsmasq</code> 上添加记录。在 <code>/etc/dnsmasq.d</code> 下新建一个文件并添加如下配置使对应域名被解析到本地</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">address</span>=/aria<span class="number">2</span>.syize.local/<span class="number">127.0.0.1</span></span><br></pre></td></tr></table></figure>

<p>重启 <code>dnsmasq</code> 服务，打开浏览器输入 <a target="_blank" rel="noopener" href="http://aria2.syize.local/">http://aria2.syize.local</a>，即可看到 AriaNg 的界面。</p>
<h3 id="aria2-安装-2"><a href="#aria2-安装-2" class="headerlink" title="aria2 安装-2"></a>aria2 安装-2</h3><p>前面我们只安装了 <code>aria2</code>，现在我们需要编写其配置文件进行配置，我懒得啰嗦直接把我自己的配置贴上来了。在 <code>~/.config/aria2/</code> 下编写配置文件 <code>aria2.conf</code></p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">## 文件保存设置 ##</span></span><br><span class="line"><span class="meta"># 下载目录。可使用绝对路径或相对路径, 默认: 当前启动位置</span></span><br><span class="line">dir=/home/syize/Downloads</span><br><span class="line"><span class="meta"># 磁盘缓存, 0 为禁用缓存，默认:16M</span></span><br><span class="line"><span class="meta"># 磁盘缓存的作用是把下载的数据块临时存储在内存中，然后集中写入硬盘，以减少磁盘 I/O ，提升读写性能，延长硬盘寿命。</span></span><br><span class="line"><span class="meta"># 建议在有足够的内存空闲情况下适当增加，但不要超过剩余可用内存空间大小。</span></span><br><span class="line"><span class="meta"># 此项值仅决定上限，实际对内存的占用取决于网速(带宽)和设备性能等其它因素。</span></span><br><span class="line">disk-cache=<span class="number">64</span>M</span><br><span class="line"><span class="meta"># 文件预分配方式, 可选：none, prealloc, trunc, falloc, 默认:prealloc</span></span><br><span class="line"><span class="meta"># 预分配对于机械硬盘可有效降低磁盘碎片、提升磁盘读写性能、延长磁盘寿命。</span></span><br><span class="line"><span class="meta"># 机械硬盘使用 ext4（具有扩展支持），btrfs，xfs 或 NTFS（仅 MinGW 编译版本）等文件系统建议设置为 falloc</span></span><br><span class="line"><span class="meta"># 若无法下载，提示 fallocate failed.cause：Operation not supported 则说明不支持，请设置为 none</span></span><br><span class="line"><span class="meta"># prealloc 分配速度慢, trunc 无实际作用，不推荐使用。</span></span><br><span class="line"><span class="meta"># 固态硬盘不需要预分配，只建议设置为 none ，否则可能会导致双倍文件大小的数据写入，从而影响寿命。</span></span><br><span class="line">file-allocation=none</span><br><span class="line"><span class="meta"># 文件预分配大小限制。小于此选项值大小的文件不预分配空间，单位 K 或 M，默认：5M</span></span><br><span class="line">no-file-allocation-limit=<span class="number">64</span>M</span><br><span class="line"><span class="meta"># 断点续传continue=true</span></span><br><span class="line"><span class="meta"># 始终尝试断点续传，无法断点续传则终止下载，默认：true</span></span><br><span class="line">always-resume=<span class="literal">false</span></span><br><span class="line"><span class="meta"># 不支持断点续传的 URI 数值，当 always-resume=false 时生效。# 达到这个数值从将头开始下载，值为 0 时所有 URI 不支持断点续传时才从头开始下载。</span></span><br><span class="line">max-resume-failure-tries=<span class="number">0</span></span><br><span class="line"><span class="meta"># 获取服务器文件时间，默认:false</span></span><br><span class="line">remote-time=<span class="literal">true</span></span><br><span class="line"><span class="meta">## 进度保存设置 ##</span></span><br><span class="line"><span class="meta"># 从会话文件中读取下载任务</span></span><br><span class="line">input-file=/home/syize/.config/aria2/aria2.session</span><br><span class="line"><span class="meta"># 会话文件保存路径# Aria2 退出时或指定的时间间隔会保存`错误/未完成`的下载任务到会话文件</span></span><br><span class="line">save-session=/home/syize/.config/aria2/aria2.session</span><br><span class="line"><span class="meta"># 任务状态改变后保存会话的间隔时间（秒）, 0 为仅在进程正常退出时保存, 默认:0</span></span><br><span class="line"><span class="meta"># 为了及时保存任务状态、防止任务丢失，此项值只建议设置为 1</span></span><br><span class="line">save-session-interval=<span class="number">1</span></span><br><span class="line"><span class="meta"># 自动保存任务进度到控制文件(*.aria2)的间隔时间（秒），0 为仅在进程正常退出时保存，默认：60</span></span><br><span class="line"><span class="meta"># 此项值也会间接影响从内存中把缓存的数据写入磁盘的频率# 想降低磁盘 IOPS (每秒读写次数)则提高间隔时间</span></span><br><span class="line"><span class="meta"># 想在意外非正常退出时尽量保存更多的下载进度则降低间隔时间</span></span><br><span class="line"><span class="meta"># 非正常退出：进程崩溃、系统崩溃、SIGKILL 信号、设备断电等</span></span><br><span class="line">auto-save-interval=<span class="number">20</span></span><br><span class="line"><span class="meta"># 强制保存，即使任务已完成也保存信息到会话文件, 默认:false</span></span><br><span class="line"><span class="meta"># 开启后会在任务完成后保留 .aria2 文件，文件被移除且任务存在的情况下重启后会重新下载。</span></span><br><span class="line"><span class="meta"># 关闭后已完成的任务列表会在重启后清空。</span></span><br><span class="line">force-save=<span class="literal">false</span></span><br><span class="line"><span class="meta">## 下载连接设置 ##</span></span><br><span class="line"><span class="meta"># 文件未找到重试次数，默认:0 (禁用)</span></span><br><span class="line"><span class="meta"># 重试时同时会记录重试次数，所以也需要设置 max-tries 这个选项</span></span><br><span class="line">max-file-not-found=<span class="number">10</span></span><br><span class="line"><span class="meta"># 最大尝试次数，0 表示无限，默认:5</span></span><br><span class="line">max-tries=<span class="number">0</span></span><br><span class="line"><span class="meta"># 重试等待时间（秒）, 默认:0 (禁用)</span></span><br><span class="line">retry-wait=<span class="number">10</span></span><br><span class="line"><span class="meta"># 连接超时时间（秒）。默认：60</span></span><br><span class="line">connect-timeout=<span class="number">10</span></span><br><span class="line"><span class="meta"># 超时时间（秒）。默认：60</span></span><br><span class="line">timeout=<span class="number">10</span></span><br><span class="line"><span class="meta"># 最大同时下载任务数, 运行时可修改, 默认:5</span></span><br><span class="line">max-concurrent-downloads=<span class="number">5</span></span><br><span class="line"><span class="meta"># 单服务器最大连接线程数, 任务添加时可指定, 默认:1</span></span><br><span class="line"><span class="meta"># 最大值为 16 (增强版无限制), 且受限于单任务最大连接线程数(split)所设定的值。</span></span><br><span class="line">max-connection-per-server=<span class="number">16</span></span><br><span class="line"><span class="meta"># 单任务最大连接线程数, 任务添加时可指定, 默认:5</span></span><br><span class="line">split=<span class="number">64</span></span><br><span class="line"><span class="meta"># 文件最小分段大小, 添加时可指定, 取值范围 1M-1024M (增强版最小值为 1K), 默认:20M</span></span><br><span class="line"><span class="meta"># 比如此项值为 10M, 当文件为 20MB 会分成两段并使用两个来源下载, 文件为 15MB 则只使用一个来源下载。# 理论上值越小使用下载分段就越多，所能获得的实际线程数就越大，下载速度就越快，但受限于所下载文件服务器的策略。</span></span><br><span class="line">min-split-size=<span class="number">4</span>M</span><br><span class="line"><span class="meta"># HTTP/FTP 下载分片大小，所有分割都必须是此项值的倍数，最小值为 1M (增强版为 1K)，默认：1M</span></span><br><span class="line">piece-length=<span class="number">1</span>M</span><br><span class="line"><span class="meta"># 允许分片大小变化。默认：false</span></span><br><span class="line"><span class="meta"># false：当分片大小与控制文件中的不同时将会中止下载# true：丢失部分下载进度继续下载</span></span><br><span class="line">allow-piece-length-change=<span class="literal">true</span></span><br><span class="line"><span class="meta"># 最低下载速度限制。当下载速度低于或等于此选项的值时关闭连接（增强版本为重连），此选项与 BT 下载无关。单位 K 或 M ，默认：0 (无限制)</span></span><br><span class="line">lowest-speed-limit=<span class="number">0</span></span><br><span class="line"><span class="meta"># 全局最大下载速度限制, 运行时可修改, 默认：0 (无限制)</span></span><br><span class="line">max-overall-download-limit=<span class="number">0</span></span><br><span class="line"><span class="meta"># 单任务下载速度限制, 默认：0 (无限制)</span></span><br><span class="line">max-download-limit=<span class="number">0</span></span><br><span class="line"><span class="meta"># 禁用 IPv6, 默认:false</span></span><br><span class="line">disable-ipv6=<span class="literal">true</span></span><br><span class="line"><span class="meta"># GZip 支持，默认:false</span></span><br><span class="line">http-accept-gzip=<span class="literal">true</span></span><br><span class="line"><span class="meta"># URI 复用，默认: true</span></span><br><span class="line">reuse-uri=<span class="literal">false</span></span><br><span class="line"><span class="meta"># 禁用 netrc 支持，默认:false</span></span><br><span class="line">no-netrc=<span class="literal">true</span></span><br><span class="line"><span class="meta"># 允许覆盖，当相关控制文件(.aria2)不存在时从头开始重新下载。默认:false</span></span><br><span class="line">allow-overwrite=<span class="literal">false</span></span><br><span class="line"><span class="meta"># 文件自动重命名，此选项仅在 HTTP(S)/FTP 下载中有效。新文件名在名称之后扩展名之前加上一个点和一个数字（1..9999）。默认:true</span></span><br><span class="line">auto-file-renaming=<span class="literal">true</span></span><br><span class="line"><span class="meta"># 使用 UTF-8 处理 Content-Disposition ，默认:false</span></span><br><span class="line">content-disposition-<span class="keyword">default</span>-utf8=<span class="literal">true</span></span><br><span class="line"><span class="meta"># 最低 TLS 版本，可选：TLSv1.1、TLSv1.2、TLSv1.3 默认:TLSv1.2</span></span><br><span class="line"><span class="meta">#min-tls-version=TLSv1.2</span></span><br><span class="line"><span class="meta"># prosy</span></span><br><span class="line">http-proxy=http:<span class="comment">//127.0.0.1:7890</span></span><br><span class="line">https-proxy=http:<span class="comment">//127.0.0.1:7890</span></span><br><span class="line"><span class="meta">## BT/PT 下载设置 ##</span></span><br><span class="line"><span class="meta"># BT 监听端口(TCP), 默认:6881-6999</span></span><br><span class="line"><span class="meta"># 直通外网的设备，比如 VPS ，务必配置防火墙和安全组策略允许此端口入站# 内网环境的设备，比如 NAS ，除了防火墙设置，还需在路由器设置外网端口转发到此端口</span></span><br><span class="line">listen-port=<span class="number">51413</span></span><br><span class="line"><span class="meta"># DHT 网络与 UDP tracker 监听端口(UDP), 默认:6881-6999</span></span><br><span class="line"><span class="meta"># 因协议不同，可以与 BT 监听端口使用相同的端口，方便配置防火墙和端口转发策略。</span></span><br><span class="line">dht-listen-port=<span class="number">51413</span></span><br><span class="line"><span class="meta"># 启用 IPv4 DHT 功能, PT 下载(私有种子)会自动禁用, 默认:true</span></span><br><span class="line">enable-dht=<span class="literal">true</span></span><br><span class="line"><span class="meta"># 启用 IPv6 DHT 功能, PT 下载(私有种子)会自动禁用，默认:false</span></span><br><span class="line"><span class="meta"># 在没有 IPv6 支持的环境开启可能会导致 DHT 功能异常</span></span><br><span class="line">enable-dht6=<span class="literal">true</span></span><br><span class="line"><span class="meta"># 指定 BT 和 DHT 网络中的 IP 地址# 使用场景：在家庭宽带没有公网 IP 的情况下可以把 BT 和 DHT 监听端口转发至具有公网 IP 的服务器，在此填写服务器的 IP ，可以提升 BT 下载速率。</span></span><br><span class="line"><span class="meta">#bt-external-ip=</span></span><br><span class="line"><span class="meta"># IPv4 DHT 文件路径，默认：$HOME/.aria2/dht.dat</span></span><br><span class="line">dht-file-path=/home/syize/.config/aria2/dht.dat</span><br><span class="line"><span class="meta"># IPv6 DHT 文件路径，默认：$HOME/.aria2/dht6.dat</span></span><br><span class="line">dht-file-path6=/home/syize/.config/aria2/dht6.dat</span><br><span class="line"><span class="meta"># IPv4 DHT 网络引导节点</span></span><br><span class="line">dht-entry-point=dht.transmissionbt.com:<span class="number">6881</span></span><br><span class="line"><span class="meta"># IPv6 DHT 网络引导节点</span></span><br><span class="line">dht-entry-point6=dht.transmissionbt.com:<span class="number">6881</span></span><br><span class="line"><span class="meta"># 本地节点发现, PT 下载(私有种子)会自动禁用 默认:false</span></span><br><span class="line">bt-enable-lpd=<span class="literal">true</span></span><br><span class="line"><span class="meta"># 指定用于本地节点发现的接口，可能的值：接口，IP地址# 如果未指定此选项，则选择默认接口。</span></span><br><span class="line"><span class="meta">#bt-lpd-interface=</span></span><br><span class="line"><span class="meta"># 启用节点交换, PT 下载(私有种子)会自动禁用, 默认:true</span></span><br><span class="line">enable-peer-exchange=<span class="literal">true</span></span><br><span class="line"><span class="meta"># BT 下载最大连接数（单任务），运行时可修改。0 为不限制，默认:55</span></span><br><span class="line"><span class="meta"># 理想情况下连接数越多下载越快，但在实际情况是只有少部分连接到的做种者上传速度快，其余的上传慢或者不上传。</span></span><br><span class="line"><span class="meta"># 如果不限制，当下载非常热门的种子或任务数非常多时可能会因连接数过多导致进程崩溃或网络阻塞。</span></span><br><span class="line"><span class="meta"># 进程崩溃：如果设备 CPU 性能一般，连接数过多导致 CPU 占用过高，因资源不足 Aria2 进程会强制被终结。</span></span><br><span class="line"><span class="meta"># 网络阻塞：在内网环境下，即使下载没有占满带宽也会导致其它设备无法正常上网。因远古低性能路由器的转发性能瓶颈导致。</span></span><br><span class="line">bt-max-peers=<span class="number">128</span></span><br><span class="line"><span class="meta"># BT 下载期望速度值（单任务），运行时可修改。单位 K 或 M 。默认:50K</span></span><br><span class="line"><span class="meta"># BT 下载速度低于此选项值时会临时提高连接数来获得更快的下载速度，不过前提是有更多的做种者可供连接。</span></span><br><span class="line"><span class="meta"># 实测临时提高连接数没有上限，但不会像不做限制一样无限增加，会根据算法进行合理的动态调节。</span></span><br><span class="line">bt-request-peer-speed-limit=<span class="number">10</span>M</span><br><span class="line"><span class="meta"># 全局最大上传速度限制, 运行时可修改, 默认:0 (无限制)</span></span><br><span class="line"><span class="meta"># 设置过低可能影响 BT 下载速度</span></span><br><span class="line">max-overall-upload-limit=<span class="number">2</span>M</span><br><span class="line"><span class="meta"># 单任务上传速度限制, 默认:0 (无限制)</span></span><br><span class="line">max-upload-limit=<span class="number">0</span></span><br><span class="line"><span class="meta"># 最小分享率。当种子的分享率达到此选项设置的值时停止做种, 0 为一直做种, 默认:1.0</span></span><br><span class="line"><span class="meta"># 强烈建议您将此选项设置为大于等于 1.0</span></span><br><span class="line">seed-ratio=<span class="number">1.0</span></span><br><span class="line"><span class="meta"># 最小做种时间（分钟）。设置为 0 时将在 BT 任务下载完成后停止做种。</span></span><br><span class="line">seed-time=<span class="number">0</span></span><br><span class="line"><span class="meta"># 做种前检查文件哈希, 默认:true</span></span><br><span class="line">bt-hash-check-seed=<span class="literal">true</span></span><br><span class="line"><span class="meta"># 继续之前的BT任务时, 无需再次校验, 默认:false</span></span><br><span class="line">bt-seed-unverified=<span class="literal">false</span></span><br><span class="line"><span class="meta"># BT tracker 服务器连接超时时间（秒）。默认：60</span></span><br><span class="line"><span class="meta"># 建立连接后，此选项无效，将使用 bt-tracker-timeout 选项的值</span></span><br><span class="line">bt-tracker-connect-timeout=<span class="number">10</span></span><br><span class="line"><span class="meta"># BT tracker 服务器超时时间（秒）。默认：60</span></span><br><span class="line">bt-tracker-timeout=<span class="number">10</span></span><br><span class="line"><span class="meta"># BT 服务器连接间隔时间（秒）。默认：0 (自动)</span></span><br><span class="line"><span class="meta">#bt-tracker-interval=0</span></span><br><span class="line"><span class="meta"># BT 下载优先下载文件开头或结尾</span></span><br><span class="line">bt-prioritize-piece=head=<span class="number">32</span>M,tail=<span class="number">32</span>M</span><br><span class="line"><span class="meta"># 保存通过 WebUI(RPC) 上传的种子文件(.torrent)，默认:true</span></span><br><span class="line"><span class="meta"># 所有涉及种子文件保存的选项都建议开启，不保存种子文件有任务丢失的风险。</span></span><br><span class="line"><span class="meta"># 通过 RPC 自定义临时下载目录可能不会保存种子文件。</span></span><br><span class="line">rpc-save-upload-metadata=<span class="literal">true</span></span><br><span class="line"><span class="meta"># 下载种子文件(.torrent)自动开始下载, 默认:true，可选：false|mem</span></span><br><span class="line"><span class="meta"># true：保存种子文件# false：仅下载种子文件# mem：将种子保存在内存中</span></span><br><span class="line">follow-torrent=<span class="literal">true</span></span><br><span class="line"><span class="meta"># 种子文件下载完后暂停任务，默认：false</span></span><br><span class="line"><span class="meta"># 在开启 follow-torrent 选项后下载种子文件或磁力会自动开始下载任务进行下载，而同时开启当此选项后会建立相关任务并暂停。</span></span><br><span class="line">pause-metadata=<span class="literal">false</span></span><br><span class="line"><span class="meta"># 保存磁力链接元数据为种子文件(.torrent), 默认:false</span></span><br><span class="line">bt-save-metadata=<span class="literal">true</span></span><br><span class="line"><span class="meta"># 加载已保存的元数据文件(.torrent)，默认:false</span></span><br><span class="line">bt-load-saved-metadata=<span class="literal">true</span></span><br><span class="line"><span class="meta"># 删除 BT 下载任务中未选择文件，默认:false</span></span><br><span class="line">bt-remove-unselected-file=<span class="literal">true</span></span><br><span class="line"><span class="meta"># BT强制加密, 默认: false</span></span><br><span class="line"><span class="meta"># 启用后将拒绝旧的 BT 握手协议并仅使用混淆握手及加密。可以解决部分运营商对 BT 下载的封锁，且有一定的防版权投诉与迅雷吸血效果。</span></span><br><span class="line"><span class="meta"># 此选项相当于后面两个选项(bt-require-crypto=true, bt-min-crypto-level=arc4)的快捷开启方式，但不会修改这两个选项的值。</span></span><br><span class="line">bt-force-encryption=<span class="literal">true</span></span><br><span class="line"><span class="meta"># BT加密需求，默认：false</span></span><br><span class="line"><span class="meta"># 启用后拒绝与旧的 BitTorrent 握手协议(\19BitTorrent protocol)建立连接，始终使用混淆处理握手。</span></span><br><span class="line"><span class="meta">#bt-require-crypto=true</span></span><br><span class="line"><span class="meta"># BT最低加密等级，可选：plain（明文），arc4（加密），默认：plain</span></span><br><span class="line"><span class="meta">#bt-min-crypto-level=arc4</span></span><br><span class="line"><span class="meta"># 分离仅做种任务，默认：false</span></span><br><span class="line"><span class="meta"># 从正在下载的任务中排除已经下载完成且正在做种的任务，并开始等待列表中的下一个任务。</span></span><br><span class="line">bt-detach-seed-only=<span class="literal">true</span></span><br><span class="line"><span class="meta">## 客户端伪装 ##</span></span><br><span class="line"><span class="meta"># 自定义 User Agent</span></span><br><span class="line">user-agent=Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">93.0</span><span class="number">.4577</span><span class="number">.63</span> Safari/<span class="number">537.36</span> Edg/<span class="number">93.0</span><span class="number">.961</span><span class="number">.47</span></span><br><span class="line"><span class="meta"># BT 客户端伪装</span></span><br><span class="line"><span class="meta"># PT 下载需要保持 user-agent 和 peer-agent 两个参数一致</span></span><br><span class="line"><span class="meta"># 部分 PT 站对 Aria2 有特殊封禁机制，客户端伪装不一定有效，且有封禁账号的风险。</span></span><br><span class="line"><span class="meta">#user-agent=Deluge 1.3.15</span></span><br><span class="line">peer-agent=Deluge <span class="number">1.3</span><span class="number">.15</span></span><br><span class="line">peer-id-prefix=-DE13F0-</span><br><span class="line"><span class="meta">## 执行额外命令 ##</span></span><br><span class="line"><span class="meta"># 下载停止后执行的命令</span></span><br><span class="line"><span class="meta"># 从 正在下载 到 删除、错误、完成 时触发。暂停被标记为未开始下载，故与此项无关。</span></span><br><span class="line">on-download-stop=/home/syize/.config/aria2/delete.sh</span><br><span class="line"><span class="meta"># 下载完成后执行的命令# 此项未定义则执行 下载停止后执行的命令 (on-download-stop)</span></span><br><span class="line">on-download-complete=/home/aria2/.aria2/clean.sh</span><br><span class="line"><span class="meta"># 下载错误后执行的命令# 此项未定义则执行 下载停止后执行的命令 (on-download-stop)</span></span><br><span class="line"><span class="meta">#on-download-error=</span></span><br><span class="line"><span class="meta"># 下载暂停后执行的命令</span></span><br><span class="line"><span class="meta">#on-download-pause=</span></span><br><span class="line"><span class="meta"># 下载开始后执行的命令</span></span><br><span class="line"><span class="meta">#on-download-start=</span></span><br><span class="line"><span class="meta"># BT 下载完成后执行的命令</span></span><br><span class="line"><span class="meta">#on-bt-download-complete=</span></span><br><span class="line"><span class="meta">## RPC 设置 ##</span></span><br><span class="line"><span class="meta"># 启用 JSON-RPC/XML-RPC 服务器, 默认:false</span></span><br><span class="line">enable-rpc=<span class="literal">true</span></span><br><span class="line"><span class="meta"># 接受所有远程请求, 默认:false</span></span><br><span class="line">rpc-allow-origin-all=<span class="literal">true</span></span><br><span class="line"><span class="meta"># 允许外部访问, 默认:false</span></span><br><span class="line">rpc-listen-all=<span class="literal">true</span></span><br><span class="line"><span class="meta"># RPC 监听端口, 默认:6800</span></span><br><span class="line">rpc-listen-port=<span class="number">6800</span></span><br><span class="line"><span class="meta"># RPC 密钥</span></span><br><span class="line">rpc-secret=XXXXXXXX</span><br><span class="line"><span class="meta"># RPC 最大请求大小</span></span><br><span class="line">rpc-max-request-size=<span class="number">10</span>M</span><br><span class="line"><span class="meta"># RPC 服务 SSL/TLS 加密, 默认：false</span></span><br><span class="line"><span class="meta"># 启用加密后必须使用 https 或者 wss 协议连接</span></span><br><span class="line"><span class="meta"># 不推荐开启，建议使用 web server 反向代理，比如 Nginx、Caddy ，灵活性更强。</span></span><br><span class="line"><span class="meta">#rpc-secure=false</span></span><br><span class="line"><span class="meta"># 在 RPC 服务中启用 SSL/TLS 加密时的证书文件(.pem/.crt)</span></span><br><span class="line"><span class="meta">#rpc-certificate=/root/.aria2/xxx.pem</span></span><br><span class="line"><span class="meta"># 在 RPC 服务中启用 SSL/TLS 加密时的私钥文件(.key)</span></span><br><span class="line"><span class="meta">#rpc-private-key=/root/.aria2/xxx.key</span></span><br><span class="line"><span class="meta"># 事件轮询方式, 可选：epoll, kqueue, port, poll, select, 不同系统默认值不同</span></span><br><span class="line"><span class="meta">#event-poll=select</span></span><br><span class="line"><span class="meta">## 高级选项 ##</span></span><br><span class="line"><span class="meta"># 启用异步 DNS 功能。默认：true</span></span><br><span class="line"><span class="keyword">async</span>-dns=<span class="literal">true</span></span><br><span class="line"><span class="meta"># 指定异步 DNS 服务器列表，未指定则从 /etc/resolv.conf 中读取。</span></span><br><span class="line"><span class="keyword">async</span>-dns-server=<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line"><span class="meta"># 指定单个网络接口，可能的值：接口，IP地址，主机名</span></span><br><span class="line"><span class="meta"># 如果接口具有多个 IP 地址，则建议指定 IP 地址。</span></span><br><span class="line"><span class="meta"># 已知指定网络接口会影响依赖本地 RPC 的连接的功能场景，即通过 localhost 和 127.0.0.1 无法与 Aria2 服务端进行讯通。</span></span><br><span class="line"><span class="meta">#interface=</span></span><br><span class="line"><span class="meta"># 指定多个网络接口，多个值之间使用逗号(,)分隔。</span></span><br><span class="line"><span class="meta"># 使用 interface 选项时会忽略此项。</span></span><br><span class="line"><span class="meta">#multiple-interface=</span></span><br><span class="line"><span class="meta">## 日志设置 ##</span></span><br><span class="line"><span class="meta"># 日志文件保存路径，忽略或设置为空为不保存，默认：不保存</span></span><br><span class="line"><span class="meta">#log=/var/log/aria2/aria2.log</span></span><br><span class="line"><span class="meta"># 日志级别，可选 debug, info, notice, warn, error 。默认：debug</span></span><br><span class="line">log-level=notice</span><br><span class="line"><span class="meta"># 控制台日志级别，可选 debug, info, notice, warn, error ，默认：notice</span></span><br><span class="line">console-log-level=notice</span><br><span class="line"><span class="meta"># 安静模式，禁止在控制台输出日志，默认：false</span></span><br><span class="line">quiet=<span class="literal">false</span></span><br><span class="line"><span class="meta"># 下载进度摘要输出间隔时间（秒），0 为禁止输出。默认：60</span></span><br><span class="line">summary-interval=<span class="number">0</span></span><br><span class="line"><span class="meta">## 增强扩展设置(非官方) ##</span></span><br><span class="line"><span class="meta"># 仅适用于 myfreeer/aria2-build-msys2 (Windows) 和 P3TERX/Aria2-Pro-Core (GNU/Linux) 项目所构建的增强版本# 在服务器返回 HTTP 400 Bad Request 时重试，仅当 retry-wait &gt; 0 时有效，默认 false</span></span><br><span class="line"><span class="meta">#retry-on-400=true</span></span><br><span class="line"><span class="meta"># 在服务器返回 HTTP 403 Forbidden 时重试，仅当 retry-wait &gt; 0 时有效，默认 false</span></span><br><span class="line"><span class="meta">#retry-on-403=true</span></span><br><span class="line"><span class="meta"># 在服务器返回 HTTP 406 Not Acceptable 时重试，仅当 retry-wait &gt; 0 时有效，默认 false</span></span><br><span class="line"><span class="meta">#retry-on-406=true</span></span><br><span class="line"><span class="meta"># 在服务器返回未知状态码时重试，仅当 retry-wait &gt; 0 时有效，默认 false</span></span><br><span class="line"><span class="meta">#retry-on-unknown=true</span></span><br><span class="line"><span class="meta"># 是否发送 Want-Digest HTTP 标头。默认：false (不发送)</span></span><br><span class="line"><span class="meta"># 部分网站会把此标头作为特征来检测和屏蔽 Aria2</span></span><br><span class="line"><span class="meta">#http-want-digest=false</span></span><br></pre></td></tr></table></figure>

<p>然后编写 <code>systemd</code> 配置文件。创建目录 <code>~/.config/systemd/user</code>，编写文件 <code>~/.config/systemd/user/aria2.service</code></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=aria2 service</span><br><span class="line"><span class="attr">After</span>=network.target</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">Type</span>=simple</span><br><span class="line"><span class="attr">UMask</span>=<span class="number">0022</span></span><br><span class="line"><span class="attr">ExecStart</span>=/usr/bin/aria2c --conf-path=/home/syize/.config/aria2/aria2.conf</span><br><span class="line"><span class="attr">ExecStop</span>=/bin/kill <span class="variable">$MAINPID</span></span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=default.target</span><br></pre></td></tr></table></figure>

<p>创建 aria2 的文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">touch ~/.config/aria2/aria2.session</span><br><span class="line">touch ~/.config/aria2/dht.dat</span><br><span class="line">touch ~/.config/aria2/dht6.dat</span><br></pre></td></tr></table></figure>

<p>其启动服务，并打开 AriaNg 查看是否能够连接成功</p>
<blockquote>
<p>请注意在 RPC 设置页面填入正确的密钥</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl --user start aria2</span><br></pre></td></tr></table></figure>


    </div>
    
    <div class="post__license">
        <p>
            <strong>Author: </strong>Syize
        </p>
        <p>
            <strong>
                Permalink: 
            </strong>
            <a href="https://blog.syize.cn/2021/12/28/install-arch-and-kde/">https://blog.syize.cn/2021/12/28/install-arch-and-kde/</a>
        </p>
        
            <strong>
                <p>本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.syize.cn/">Syizeのblog</a>！</p>

            </strong>
        
    </div>
 
    <div class="post-footer__meta"><p>updated at 2023-01-10</p></div> 
    <div class="post-entry__tags"><a href="/tags/Arch/" class="post-tags__link button"># Arch</a><a href="/tags/KDE/" class="post-tags__link button"># KDE</a></div> 
</article>


    <div class="nav">
        <div class="nav__prev">
            
                <a href="/2021/12/29/clash-web-dashboard-with-nginx/" class="nav__link">
                    <div>
                        <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="24" height="24"><path d="M589.088 790.624L310.464 512l278.624-278.624 45.248 45.248L400.96 512l233.376 233.376z" fill="#808080"></path></svg>
                    </div>
                    <div>
                        <div class="nav__label">
                            Previous Post
                        </div>
                        <div class="nav__title">
                            clash for linux 的设置与 web 控制台
                        </div>
                    </div>
                </a>
            
        </div>
        <div class="nav__next">
            
                <a href="/2021/12/26/read-cython-and-learn/" class="nav__link">
                    <div>
                        <div class="nav__label">
                            Next Post
                        </div>
                        <div class="nav__title">
                            Cython 学习和使用
                        </div>
                    </div>
                    <div>
                        <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="24" height="24"><path d="M434.944 790.624l-45.248-45.248L623.04 512l-233.376-233.376 45.248-45.248L713.568 512z" fill="#808080"></path></svg>
                    </div>
                </a>
            
        </div>
    </div>



    <div class="post__comments post__with-toc content-card" id="comment">
        
    <h4>Comments</h4>
    
    
    
    
    
    <div id="gitalk-container"></div>

    
    
    
    
    
    


    </div>



</main>

            <footer class="footer">
    
    


    
     
 

 
    
        
        <p class="footer-copyright">
            Copyright © 2021&nbsp;-&nbsp;2023 <a href="/">Syize の blog</a>
        </p>
    
    
    <p>Powered by <a href="https://hexo.io" target="_blank">Hexo</a> | Theme - <a href="https://github.com/ChrAlpha/hexo-theme-cards" target="_blank">Cards</a></p>
</footer>

        </div>
         

 

 

 

 



 



 


    
 


    
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>

    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.4.1/dist/jquery.fancybox.min.css">

    
<script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.4.1/dist/jquery.fancybox.min.js"></script>

    <script>
        let lazyloadT = Boolean('false'),
            auto_fancybox = Boolean('false')
        if (auto_fancybox) {
            $(".post__content").find('img').each(function () {
                var element = document.createElement("a");
                $(element).attr("data-fancybox", "gallery");
                $(element).attr("href", $(this).attr("src"));
                if (lazyloadT) {
                    $(element).attr("href", $(this).attr("data-srcset"));
                }
                $(this).wrap(element);
            });
        } else {
            $(".post__content").find("fancybox").find('img').each(function () {
                var element = document.createElement("a");
                $(element).attr("data-fancybox", "gallery");
                $(element).attr("href", $(this).attr("src"));
                if (lazyloadT) {
                    $(element).attr("href", $(this).attr("data-srcset"));
                }
                $(this).wrap(element);
            });
        }
    </script>
 

 

 


    <script src='https://cdn.jsdelivr.net/npm/mermaid@8.10.2/dist/mermaid.min.js'></script>
    <script>
            mermaid.initialize(JSON.stringify(''));
    </script>
 

 


    

    
    
    

    
    
    
    <script>
        function loadComment() {
            let e, i;
            (e = document.createElement("script")).src = 'https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js',
            document.body.appendChild(e);
            e.onload = () => {
                var gitalk = new Gitalk({
                    clientID: 'f9cc68800d4b4684b855',
                    clientSecret: '41ec43e27f543f00eca863b311d04e7be6533111',
                    repo: 'blog-comment',
                    owner: 'Syize',
                    admin: 'Syize',
                    id: window.location.pathname,
                    distractionFreeMode: false
                });
                gitalk.render('gitalk-container');
            };
            (i = document.createElement("link")).rel = "stylesheet",
            i.href = 'https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css',
            document.head.appendChild(i);
        }
    
        var runningOnBrowser = typeof window !== "undefined";
        var isBot = runningOnBrowser && !("onscroll" in window) || typeof navigator !== "undefined" && /(gle|ing|ro|msn)bot|crawl|spider|yand|duckgo/i.test(navigator.userAgent);
        var supportsIntersectionObserver = runningOnBrowser && "IntersectionObserver" in window;
    
        setTimeout(function () {
            if (!isBot && supportsIntersectionObserver) {
                var comment_observer = new IntersectionObserver(function(entries) {
                    if (entries[0].isIntersecting) {
                        loadComment();
                        comment_observer.disconnect();
                    }
                }, { threshold: [0] });
                comment_observer.observe(document.getElementById('comment'));
            } else {
                loadComment();
            }
        }, 1);
    </script>

    
    

    
    
    
    
    

    
    
    



    </body>
</html>
